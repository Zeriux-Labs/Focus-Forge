<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Forge - Typing Animation Test</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #111;
      color: #eee;
      margin: 0;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      font-weight: 900;
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
      color: white;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .section {
      margin-top: 1rem;
      width: 100%;
      padding: 0 0.5rem;
    }

    .ai-error, .ai-notice, .ai-response {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .ai-error {
      background-color: rgba(255, 0, 0, 0.1);
      border: 1px solid rgba(255, 0, 0, 0.3);
    }

    .ai-notice {
      background-color: rgba(255, 165, 0, 0.1);
      border: 1px solid rgba(255, 165, 0, 0.3);
    }

    .ai-response {
      background-color: rgba(0, 128, 0, 0.1);
      border: 1px solid rgba(0, 128, 0, 0.3);
    }

    @keyframes blink {
      0%, 100% { border-right-color: transparent; }
      50% { border-right-color: #ccc; }
    }

    #typingText, #errorText, #geminiErrorText, #geminiErrorHint, #limitedDataText, #currentSitesText, #noDataText {
      border-right: 2px solid #ccc;
      padding-right: 2px;
      animation: blink 0.7s infinite;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    #typingText strong {
      font-weight: bold;
      color: #fff;
    }

    #typingText em {
      font-style: italic;
      color: #ddd;
    }

    button {
      background-color: #444;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 8px;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #666;
    }

    .buttons {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Focus Forge - Typing Animation Test</h1>

    <div class="buttons">
      <button id="showAiResponse">Show AI Response</button>
      <button id="showError">Show Error</button>
      <button id="showNotice">Show Notice</button>
    </div>

    <div class="section">
      <div id="contentArea">
        <p>Click one of the buttons above to see the typing animation in action.</p>
      </div>
    </div>
  </div>

  <script>
    // Fixed typing speed (milliseconds per character)
    const TYPING_SPEED = 10;

    // Function to create typing animation effect
    function createTypingAnimation(element, text, callback = null) {
      let i = 0;
      element.innerHTML = '';
      
      function typeWriter() {
        if (i < text.length) {
          element.innerHTML += text.charAt(i);
          i++;
          setTimeout(typeWriter, TYPING_SPEED);
        } else if (callback) {
          setTimeout(callback, 300); // Small delay before callback
        }
      }
      
      typeWriter();
    }

    // Escape HTML entities to avoid injection issues
    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, function (m) {
        return ({
          '&': "&amp;",
          '<': "&lt;",
          '>': "&gt;",
          '"': "&quot;",
          "'": "&#39;"
        })[m];
      });
    }

    // Sample AI response with markdown formatting
    const aiResponseText = `**Focus Forge Analysis**

Based on your browsing data, here are some insights:

- You spend a lot of time on *social media* sites
- Your most productive hours are in the **morning**
- Consider adding *youtube.com* to your blocked sites

Keep up the good work with Focus Forge!`;

    // Show AI response with typing animation
    document.getElementById('showAiResponse').addEventListener('click', function() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="ai-response">
          <div id="typingText" style="white-space: pre-wrap;"></div>
        </div>
      `;
      
      // Process markdown-like formatting in the AI response
      let formattedText = escapeHTML(aiResponseText)
        // Convert **text** to <strong>text</strong>
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        // Convert *text* to <em>text</em>
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        // Convert - text to bullet points
        .replace(/^- (.*?)$/gm, 'â€¢ $1');
      
      // Create typing animation effect
      createTypingAnimation(document.getElementById("typingText"), formattedText);
    });

    // Show error message with typing animation
    document.getElementById('showError').addEventListener('click', function() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="ai-error">
          <h3>Gemini AI Error</h3>
          <p id="geminiErrorText"></p>
          <p id="geminiErrorHint"></p>
        </div>
      `;
      
      const errorMessage = "Failed to get a response from Gemini AI";
      const hintText = "This could be due to API limits, network issues, or an invalid API key.";
      
      // Create typing animation with callback for the hint message
      createTypingAnimation(
        document.getElementById("geminiErrorText"), 
        errorMessage, 
        () => createTypingAnimation(document.getElementById("geminiErrorHint"), hintText)
      );
    });

    // Show notice with typing animation
    document.getElementById('showNotice').addEventListener('click', function() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="ai-notice">
          <h3>Limited browsing data available</h3>
          <p id="limitedDataText"></p>
          <p id="currentSitesText"></p>
        </div>
      `;
      
      const limitedMessage = "Only 2 site(s) tracked. Continue browsing to get more personalized insights.";
      const sitesMessage = "Current sites: youtube.com, github.com";
      
      // Create typing animation with callback for the second message
      createTypingAnimation(
        document.getElementById("limitedDataText"), 
        limitedMessage, 
        () => createTypingAnimation(document.getElementById("currentSitesText"), sitesMessage)
      );
    });
  </script>
</body>
</html>